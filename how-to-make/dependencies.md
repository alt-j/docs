# Зависимости

Зависимости - это очень просто. На вашем сайте есть форма, а в форме есть текстовое поле. Форма без инпута - бессмысленная штука. Форма - это блок, который отвечает за отправку данных, а инпут совершенно другой блок, который только и умеет, что получать данные от пользователя.  Корректная работы формы зависит от работы инпута. Это и есть зависимость :)

Блоки могут зависеть друг от друга по поведению и (или) по отображению. 

Например, инпут слушает на себе событие `onchange`, и как только оно случилось - триггерит кастомное событие "Меня заполнили текстом!", которое слушает форма. Как только форма его услышала, она отправляет данные на сервер. Это простой пример "зависимости по поведению". Такие зависимости мы резолвим с помощью [модульной системы](https://github.com/ymaps/modules). Если вы не знакомы с модулями, прочтите [эту статью](https://github.com/ymaps/modules/blob/master/what-is-this.md) и всё поймёте.


Но бывает так, что один блок использует другой не из поведения, а из отображения. Возьмём ту же форму, её стили описаны в одном стилевом файле, а стили инпута в другом. Логично где-то указать, что форма зависит от инпута. Зачем разработчику, подключающему форму на свою страницу, заботиться о том, какие блоки понадобятся для корректной работы формы? Пусть сама форма про себя волнуется.

Зависимость описывается простым текстом, почти человеческим языком.

Например, блок `y-header` использует блок `y-input`. Создаем файл `y-header.deps.yaml` со следующим содержимым:

```yaml
- y-input
```

Да, мы используем формат `YAML` для описания зависимостей. Он немногословный, простой и понятный. Хотите разобраться досконально, прочитайте [руководство](http://en.wikipedia.org/wiki/YAML). А в общих чертах мы и сами вам расскажем :)

## Структура

Каждый `deps.yaml`-файл - это массив. Каждый элемент массива начинается со знака минус (`-`).

Пример зависимостей шапки от двух блоков:

```yaml
- y-input
- y-button
```
Этим кодом мы объявляем: шапка зависит от инпута и кнопки.

Если вам надо указать не только имя блока, а ещё что-то (например view блока), тогда зависимость описываем чуть детальнее: указываем `block` и `view`, но по-прежнему это делается после служебного знака (`-`). А чтобы парсер `yaml` смог понять, где заканчивается первый элемент массива и начинается второй, делаем отступ от начала строки, выравнивая содержимое:

```yaml
- block: y-button
  view: islet-active
- block: y-input
  view: islet-icons
```

Вот и вся премудрость про `yaml`-синтаксис. Просто и интуитивно.

## Обязательные зависимости

Флагом `required` в значении `yes` обозначаются те зависимости, код которых при сборке должен предшествовать коду текущего блока. Например, миксины должны быть определены до того, как их будут использовать.

Пример использования `required`:

```yaml
- block: y-design
  required: yes
```

Если этот кода написан для шапки, в результате сборки код блока `y-design` окажется в собранном файле раньше, чем код самой шапки.

## Наследие прошлого

В данный момент `BEM`-структура все еще используется в `BEViS` для того, чтобы хранить `i18n`-кейсеты и обращаться к ним. Для того, чтобы указать зависимость от нужного кейсета, можно воспользоваться следующей конструкцией:

```yaml
- block: i18n
  mods: {keyset: general}
```

## Можно ли обойтись без зависимостей?

Кажется, что декларации блоков в `*.page.js` вполне достаточно, чтобы сборщик понял,
от каких блоков зависит страница.

Нередки случаи, когда блок А в своих шаблонах декларирует блок Б. Если бы зависимости строились автоматическим
 инструментом, анализ всех шаблонов обходился бы "дорого". Замедлится сборка проект,
 и кодовая база бивис-движка заметно увеличится.

Мы могли бы сделать такую автоматизацию, если бы без неё вообще никак. Но в случае с декларацией блоков эта
польза слишком мала по сравнению с вредом, который мы получим. Поэтому мы явно указываем странице,
что она зависит от такого-то блока.
